{{>header}}

<body style="background-color: #f8f9fa;">
  <div class="container py-4">

    <!-- DATOS DEL JUEGO -->
    <div class="text-center mb-4">
      <h1 class="fw-bold text-primary">{{game.name}}</h1>
      <p class="text-muted">{{game.description}}</p>
    </div>

    {{#game.image}}
    <div class="text-center mb-3">
      <img src="{{game.image}}" class="rounded shadow-sm" alt="Imagen del juego"
        style="max-height:180px; object-fit:cover;">
    </div>
    {{/game.image}}

    {{#game.video}}
    <div class="mb-4">
      <video class="w-100 rounded shadow-sm" controls>
        <source src="{{game.video}}" type="video/mp4">
        Tu navegador no soporta video.
      </video>
    </div>
    {{/game.video}}

    <!-- BLOQUE DE ATRIBUTOS -->
    <div class="p-4 rounded-4 mb-4 shadow-sm" style="background-color:#e7f1ff; border:1px solid #cfe2ff;">
      <div class="row text-center align-items-center">
        <div class="col-md-3 mb-2 mb-md-0">
          <strong class="text-primary">Tipo:</strong><br> {{game.gameType}}
        </div>
        <div class="col-md-3 mb-2 mb-md-0">
          <strong class="text-primary">Enigmas:</strong><br> {{game.numberOfRiddles}}
        </div>
        <div class="col-md-3 mb-2 mb-md-0">
          <strong class="text-primary">Leaderboard:</strong><br>
          {{#game.hasLeaderboard}}Sí{{/game.hasLeaderboard}}{{^game.hasLeaderboard}}No{{/game.hasLeaderboard}}
          <span class="help-tip" tabindex="0"
            data-tip="Si está activado, el juego muestra una tabla de clasificación con las puntuaciones de los jugadores.">i</span>
        </div>
        <div class="col-md-3">
          <strong class="text-primary">Manual:</strong><br>
          {{#game.manual}}Sí{{/game.manual}}{{^game.manual}}No{{/game.manual}}
          <span class="help-tip" tabindex="0"
            data-tip="Indica que este registro fue creado o configurado manualmente desde el panel de administración.">i</span>
        </div>
      </div>
    </div>

    <!-- FASES -->
    <h2 class="mb-3 text-success fw-semibold">✅ Fases del juego</h2>

    {{^phases}}
    <div class="alert alert-warning">Este juego aún no tiene fases.</div>
    {{/phases}}

    <div class="accordion" id="phasesAccordion">
      {{#phases}}
      <div class="accordion-item shadow-sm border border-success-subtle mb-3" style="background-color:#e9fcef;">
        <h2 class="accordion-header" id="phase-{{id}}">
          <button class="accordion-button collapsed fw-semibold text-success" type="button" data-bs-toggle="collapse"
            data-bs-target="#collapse-{{id}}" aria-expanded="false" aria-controls="collapse-{{id}}">
            ✅ {{phaseName}}
          </button>
        </h2>
        <div id="collapse-{{id}}" class="accordion-collapse collapse" data-bs-parent="#phasesAccordion">
          <div class="accordion-body">
            <p>{{description}}</p>

            {{#image}}
            <div class="text-center mb-3">
              <img src="{{image}}" class="img-fluid rounded shadow-sm" style="max-height:150px; object-fit:cover;"
                alt="Imagen de fase">
            </div>
            {{/image}}

            {{#video}}
            <div class="mb-3">
              <video class="w-100 rounded shadow-sm" controls>
                <source src="{{video}}" type="video/mp4">
              </video>
            </div>
            {{/video}}

            {{#latitude}}
            <p><strong>📍 Ubicación:</strong> {{latitude}}, {{longitude}}</p>
            {{/latitude}}

            {{#mapUrl}}
            <p><a href="{{mapUrl}}" target="_blank" class="btn btn-sm btn-outline-success">🌍 Ver en mapa</a></p>
            {{/mapUrl}}

            <!-- ENIGMAS -->
            <div class="mt-4 p-3 rounded-4 border border-warning-subtle" style="background-color:#fff9e6;">
              <h5 class="text-warning fw-semibold mb-3">💡 Enigmas de la fase</h5>

              {{^enigmas}}
              <div class="alert alert-secondary mt-2">No hay enigmas en esta fase.</div>
              {{/enigmas}}

              <div class="accordion" id="enigmasAccordion-{{id}}">
                {{#enigmas}}
                <div class="accordion-item mb-2 border-0 shadow-sm">
                  <h2 class="accordion-header" id="enigma-{{id}}">
                    <button class="accordion-button collapsed fw-semibold text-dark" type="button"
                      data-bs-toggle="collapse" data-bs-target="#collapseEnigma-{{id}}" aria-expanded="false"
                      aria-controls="collapseEnigma-{{id}}">
                      Enigma #{{enigmaNumber}}
                    </button>
                  </h2>
                  <div id="collapseEnigma-{{id}}" class="accordion-collapse collapse"
                    data-bs-parent="#enigmasAccordion-{{id}}">
                    <div class="accordion-body">
                      <p><strong>❓ Pregunta:</strong> {{enigma}}</p>
                      <p><strong>✅ Respuesta:</strong> {{answer}}</p>
                      {{#hint1}}<p><strong>💡 Pista 1:</strong> {{hint1}}</p>{{/hint1}}
                      {{#hint2}}<p><strong>💡 Pista 2:</strong> {{hint2}}</p>{{/hint2}}
                      <p class="text-muted small mb-0"><strong>Formato:</strong> {{answerFormat}}</p>
                    </div>
                  </div>
                </div>
                {{/enigmas}}
              </div>
            </div>
          </div>
        </div>
      </div>
      {{/phases}}
    </div>

    <div class="text-center">
      <a href="/" class="btn btn-secondary mt-4">Volver</a>
    </div>

  </div>
</body>

{{>footer}}
